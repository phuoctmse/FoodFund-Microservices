generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("USERS_DATABASE_URL")
}

model User {
  id                     String                  @id @default(uuid())
  full_name              String                  @db.Text()
  avatar_url             String                  @db.VarChar(255)
  email                  String                  @unique @db.VarChar(100)
  phone_number           String                  @unique @db.VarChar(20)
  role                   Role                    @default(DONOR)
  is_active              Boolean                 @default(true)
  user_name              String                  @unique @db.VarChar(20)
  bio                    String?                 @db.Text()
  created_at             DateTime                @default(now())
  updated_at             DateTime                @updatedAt
  Donor_Profile          Donor_Profile?
  Kitchen_Staff_Profile  Kitchen_Staff_Profile?
  Fundraiser_Profile     Fundraiser_Profile?
  Delivery_Staff_Profile Delivery_Staff_Profile?
  User_Badge             User_Badge?
  Post                   Post[]
  Post_Like              Post_Like[]
  Post_Comment           Post_Comment[]
  Campaign               Campaign[]
  Meal_Batch             Meal_Batch[]
  Delivery_Task          Delivery_Task[]
  Donation               Donation[]
  Ingredient_Request     Ingredient_Request[]
  Notification           Notification[]
  Transaction            Transaction[]

  @@map("users")
}

model Donor_Profile {
  id             String   @id @default(uuid())
  user_id        String   @unique
  user           User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  donation_count Int      @default(0)
  total_donated  BigInt   @default(0)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@map("donor_profiles")
}

model Kitchen_Staff_Profile {
  id                   String   @id @default(uuid())
  user_id              String   @unique
  user                 User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  total_batch_prepared Int      @default(0)
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt

  @@map("kitchen_staff_profiles")
}

model Delivery_Staff_Profile {
  id                  String              @id @default(uuid())
  user_id             String              @unique
  user                User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  availability_status Availability_Status @default(AVAILABLE)
  total_deliveries    Int                 @default(0)
  created_at          DateTime            @default(now())
  updated_at          DateTime            @updatedAt

  @@map("delivery_staff_profiles")
}

model Fundraiser_Profile {
  id                     String              @id @default(uuid())
  user_id                String              @unique
  user                   User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  organization_name      String              @db.Text()
  organization_address   String?             @db.Text()
  verification_status    Verification_Status @default(PENDING)
  total_campaign_created Int                 @default(0)
  created_at             DateTime            @default(now())
  updated_at             DateTime            @updatedAt

  @@map("fundraiser_profiles")
}

model Badge {
  id          String       @id @default(uuid())
  description String       @db.Text()
  icon_url    String       @db.Text()
  sort_order  Int          @default(0)
  is_active   Boolean      @default(true)
  created_at  DateTime     @default(now())
  updated_at  DateTime     @updatedAt
  User_Badge  User_Badge[]

  @@map("badges")
}

model User_Badge {
  id         String   @id @default(uuid())
  user_id    String   @unique
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  badge_id   String   @unique
  badge      Badge    @relation(fields: [badge_id], references: [id], onDelete: Cascade)
  awarded_at DateTime @default(now())

  @@map("user_badges")
}

model Campaign {
  id                 String               @id @default(uuid())
  title              String               @db.Text()
  description        String               @db.Text()
  cover_image        String               @db.VarChar(255)
  location           String               @db.Text()
  target_amount      BigInt               @default(0)
  donation_count     Int                  @default(0)
  received_amount    BigInt               @default(0)
  status             Campaign_Status      @default(ACTIVE)
  start_date         DateTime             @default(now())
  end_date           DateTime
  is_active          Boolean              @default(true)
  created_by         String
  created_by_user    User                 @relation(fields: [created_by], references: [id], onDelete: Cascade)
  approved_at        DateTime?
  created_at         DateTime             @default(now())
  updated_at         DateTime             @updatedAt
  Post               Post[]
  Meal_Batch         Meal_Batch[]
  Delivery_Task      Delivery_Task[]
  Donation           Donation[]
  Ingredient_Request Ingredient_Request[]
  Notification       Notification[]
  Transaction        Transaction[]

  @@map("campaigns")
}

model Post {
  id              String         @id @default(uuid())
  title           String         @db.Text()
  content         String         @db.Text()
  like_count      Int            @default(0)
  comment_count   Int            @default(0)
  campaign_id     String
  campaign        Campaign       @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  created_by      String
  created_by_user User           @relation(fields: [created_by], references: [id], onDelete: Cascade)
  is_active       Boolean        @default(true)
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt
  Post_Like       Post_Like[]
  Post_Comment    Post_Comment[]

  @@map("posts")
}

model Post_Like {
  id         String   @id @default(uuid())
  post_id    String
  post       Post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user_id    String
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("post_likes")
}

model Post_Comment {
  id         String   @id @default(uuid())
  post_id    String
  post       Post     @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user_id    String
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  content    String   @db.Text()
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("post_comments")
}

model Meal_Batch {
  id                 String            @id @default(uuid())
  campaign_id        String
  campaign           Campaign          @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  kitchen_staff_id   String
  kitchen_staff_user User              @relation(fields: [kitchen_staff_id], references: [id], onDelete: Cascade)
  quantity           Int               @default(0)
  cooked_date        DateTime?
  status             Meal_Batch_Status @default(PENDING)
  created_at         DateTime          @default(now())
  updated_at         DateTime          @updatedAt

  @@map("meal_batches")
}

model Delivery_Task {
  id                  String               @id @default(uuid())
  campaign_id         String
  campaign            Campaign             @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  delivery_staff_id   String
  delivery_staff_user User                 @relation(fields: [delivery_staff_id], references: [id], onDelete: Cascade)
  status              Delivery_Task_Status @default(PENDING)
  created_at          DateTime             @default(now())
  updated_at          DateTime             @updatedAt

  @@map("delivery_tasks")
}

model Donation {
  id                String   @id @default(uuid())
  donor_id          String
  donor_user        User     @relation(fields: [donor_id], references: [id], onDelete: Cascade)
  campaign_id       String
  campaign          Campaign @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  amount            BigInt   @default(0)
  message           String?  @db.Text()
  payment_reference String?  @db.VarChar(255)
  is_anonymous      Boolean  @default(false)
  created_at        DateTime @default(now())

  @@map("donations")
}

model Ingredient_Request {
  id                      String                    @id @default(uuid())
  campaign_id             String
  campaign                Campaign                  @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  kitchen_staff_id        String
  kitchen_staff_user      User                      @relation(fields: [kitchen_staff_id], references: [id], onDelete: Cascade)
  total_cost              BigInt                    @default(0)
  status                  Ingredient_Request_Status @default(PENDING)
  created_at              DateTime                  @default(now())
  Ingredient_Request_Item Ingredient_Request_Item[]

  @@map("ingredient_requests")
}

model Ingredient_Request_Item {
  id              String             @id @default(uuid())
  request_id      String
  request         Ingredient_Request @relation(fields: [request_id], references: [id], onDelete: Cascade)
  ingredient_name String             @db.Text()
  quantity        Int                @default(0)
  unit            Int                @default(0)
  estimated_price BigInt             @default(0)

  @@map("ingredient_request_items")
}

model Notification {
  id          String              @id @default(uuid())
  user_id     String
  user        User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  campaign_id String
  campaign    Campaign            @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  title       String              @db.Text()
  body        String              @db.Text()
  channel     String              @db.Text()
  status      Notification_Status @default(PENDING)
  read_at     DateTime?
  created_at  DateTime            @default(now())
  updated_at  DateTime            @updatedAt

  @@map("notifications")
}

model Transaction {
  id                String        @id @default(uuid())
  campaign_id       String
  campaign          Campaign      @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  receiver_id       String
  receiver          User          @relation(fields: [receiver_id], references: [id], onDelete: Cascade)
  receiver_type     Receiver_Type @default(USER)
  amount            BigInt        @default(0)
  payment_reference String?       @db.VarChar(255)
  created_at        DateTime      @default(now())
}

model Cost {
  id         String   @id @default(uuid())
  cost_type  String   @db.Text()
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

enum Receiver_Type {
  USER
  KITCHEN_STAFF
  DELIVERY_STAFF
}

enum Notification_Status {
  PENDING
  READ
  UNREAD
}

enum Ingredient_Request_Status {
  PENDING
  APPROVED
  REJECTED
}

enum Delivery_Task_Status {
  PENDING
  DELIVERED
  CANCELLED
}

enum Meal_Batch_Status {
  PENDING
  COOKED
  DELIVERED
  CANCELLED
}

enum Campaign_Status {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum Verification_Status {
  PENDING
  VERIFIED
  REJECTED
}

enum Availability_Status {
  AVAILABLE
  UNAVAILABLE
}

enum Role {
  DONOR
  FUNDRAISER
  KITCHEN_STAFF
  DELIVERY_STAFF
  ADMIN
}
