generator client {
  provider      = "prisma-client-js"
  output        = "../src/generated/campaign-client"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("CAMPAIGN_DATABASE_URL")
}

model Campaign {
  id                     String               @id @default(uuid())
  title                  String               @db.Text()
  description            String               @db.Text()
  cover_image            String               @db.Text()
  cover_image_file_key   String?              @db.Text()
  location               String               @db.Text()
  target_amount          BigInt               @default(0)
  donation_count         Int                  @default(0)
  received_amount        BigInt               @default(0)
  status                 Campaign_Status      @default(PENDING)
  start_date             DateTime             
  end_date               DateTime
  is_active              Boolean              @default(true)
  created_by             String              
  approved_at            DateTime?
  category_id            String?
  created_at             DateTime             @default(now())
  updated_at             DateTime             @updatedAt

  donations              Donation[]
  category               Campaign_Category?   @relation(fields: [category_id], references: [id], onDelete: SetNull)
  
  @@index([status])
  @@index([created_by])
  @@index([created_at])
  @@index([start_date, end_date])
  @@index([category_id])
  @@map("campaigns")
}

model Campaign_Category {
  id          String     @id @default(uuid())
  title       String     @db.VarChar(100)
  description String     @db.Text()
  is_active   Boolean    @default(true)
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt

  campaigns   Campaign[]

  @@index([is_active])
  @@index([title])
  @@map("campaign_categories")
}

model Donation {
  id                String   @id @default(uuid())
  donor_id          String  
  campaign_id       String
  campaign          Campaign @relation(fields: [campaign_id], references: [id], onDelete: Cascade)
  amount            BigInt   @default(0)
  message           String?  @db.Text()
  payment_reference String?  @db.Text()
  is_anonymous      Boolean  @default(false)
  created_at        DateTime @default(now())

  @@index([campaign_id])
  @@index([donor_id])
  @@map("donations")
}

enum Campaign_Status {
  PENDING
  APPROVED
  REJECTED
  ACTIVE
  COMPLETED
  CANCELLED
}