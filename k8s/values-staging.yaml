# Staging values for FoodFund microservices
# This file contains staging environment configurations

# Global settings
global:
  imageRegistry: ""
  imagePullPolicy: IfNotPresent

# Namespace
namespace:
  create: true
  name: "foodfund-staging"

# Auth Service - Staging configuration
auth:
  enabled: true
  image:
    repository: "foodfund-auth"
    tag: "staging"
    pullPolicy: Always

  replicaCount: 1  # Single replica for staging

  service:
    type: ClusterIP
    port: 8002
    targetPort: 8002

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  healthCheck:
    enabled: true
    path: "/health"
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# GraphQL Gateway - Staging configuration
gateway:
  enabled: true
  image:
    repository: "foodfund-gateway"
    tag: "staging"
    pullPolicy: Always

  replicaCount: 1  # Single replica for staging

  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  healthCheck:
    enabled: true
    path: "/health"
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# PostgreSQL - Staging configuration
postgresql:
  enabled: true

  architecture: standalone  # Single instance for staging

  auth:
    postgresPassword: "staging-password"
    username: "foodfund"
    password: "staging-password"
    database: "foodfund"

  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: "standard"

    initdb:
      scripts:
        init.sql: |
          CREATE DATABASE users_db;
          CREATE DATABASE campaigns_db;
          GRANT ALL PRIVILEGES ON DATABASE users_db TO foodfund;
          GRANT ALL PRIVILEGES ON DATABASE campaigns_db TO foodfund;

  metrics:
    enabled: false

# Ingress - Staging configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
  hosts:
    - host: staging-api.foodfund.com
      paths:
        - path: /
          pathType: Prefix

# Service Account
serviceAccount:
  create: true

# Resource limits for staging (lighter than production)
nodeSelector:
  environment: staging

tolerations: []

affinity: {}

# Network Policies
networkPolicy:
  enabled: false  # Disabled for easier testing in staging

# Jenkins - Enabled for staging CI/CD
jenkins:
  enabled: true
  image:
    repository: "jenkins/jenkins"
    tag: "lts"

  service:
    type: ClusterIP
    port: 8080
    targetPort: 8080

  persistence:
    enabled: true
    size: 20Gi
    storageClass: "standard"

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"
