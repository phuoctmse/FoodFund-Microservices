# Database Secret for External Digital Ocean Database
{{- if not .Values.postgresql.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "foodfund.fullname" . }}-database-secret
  namespace: {{ include "foodfund.namespace" . }}
  labels:
    {{- include "foodfund.labels" . | nindent 4 }}
type: Opaque
data:
  # Database connection strings for each service (base64 encoded)
  {{- $host := .Values.externalDatabase.host}}
  {{- $port := .Values.externalDatabase.port}}
  {{- $username := .Values.externalDatabase.username}}
  {{- $password := .Values.externalDatabase.password}}
  {{- $sslMode := .Values.externalDatabase.sslMode}}
  
  auth-database-url: {{ printf "postgresql://%s:%s@%s:%d/%s?sslmode=%s" $username $password $host ($port | int) .Values.externalDatabase.databases.auth $sslMode | b64enc }}
  user-database-url: {{ printf "postgresql://%s:%s@%s:%d/%s?sslmode=%s" $username $password $host ($port | int) .Values.externalDatabase.databases.user $sslMode | b64enc }}
  {{- if .Values.externalDatabase.databases.campaign }}
  # campaign-database-url: {{ printf "postgresql://%s:%s@%s:%d/%s?sslmode=%s" $username $password $host ($port | int) .Values.externalDatabase.databases.campaign $sslMode | b64enc }}
  # {{- end }}
  
  # Individual connection components (if needed separately)
  database-host: {{ $host | b64enc }}
  database-port: {{ $port | toString | b64enc }}
  database-username: {{ $username | b64enc }}
  database-password: {{ $password | b64enc }}
  database-ssl-mode: {{ $sslMode | b64enc }}
{{- end }}